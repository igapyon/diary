## [Maven] によるシンプル Java プロジェクトサンプルの作成手順

[[Apache]] [[Maven]] による、シンプルな [[Java]] プロジェクトサンプルの作り方をメモします。このページの記述は、他の `いがぴょんの日記` エントリから基本手順としても参照されています。

### Maven プロジェクト新規作成

`mvn` コマンドを用いて [[Maven]] プロジェクトを新規作成します。ここでは `/tmp` ディレクトリに とてもベーシックな Java プロジェクトを作成する例を示しています。

```sh
cd /tmp
mvn archetype:generate -DgroupId=my.sandbox -DartifactId=MySandboxApp -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false
```

これにより、`/tmp` ディレクトリに `MySandboxApp` ディレクトリが作成され、そこに基本的な Maven の Java プロジェクト一式が作成されます。

### Maven プロジェクト基礎設定およびライブラリ組み込み

Maven プロジェクトの記述ファイル `pom.xml` を編集して基礎設定およびライブラリを組み込みます。ここでは、まず `pom.xml` ファイルを開きます。

```sh
cd MySandboxApp
vi pom.xml
```

以下のような記述を `pom.xml` に追加します。（変更箇所のみ掲載しています）

```xml
	<dependencies>
		<dependency>
			<groupId>junit</groupId>
			<artifactId>junit</artifactId>
			<version>[4.12,5.0)</version>
		</dependency>
		<!-- 必要に応じて、ここに追加のライブラリ記述を追加します。 -->		
	</dependencies>

	<build>
		<plugins>
			<plugin>
				<groupId>org.codehaus.mojo</groupId>
				<artifactId>exec-maven-plugin</artifactId>
				<version>1.2.1</version>
				<configuration>
					<mainClass>my.sandbox.App</mainClass>
				</configuration>
			</plugin>
		</plugins>
	</build>
```

* `<dependencies>` 以下の　`<dependency>` には、必要に応じてライブラリを追加します。
* `<dependency>` の `<version>` 指定は、可能であれば [4.12,5.0) のように範囲指定により記述することを推奨します。
* `<build>` -> `<plugins>` -> `<plugin>` に、`<artifactId>exec-maven-plugin</artifactId>` を追加します。これにより、後述の `exec:java` 指定が有効になります。メインクラスを `<mainClass>` に記述することにより有効に機能するようになります。

### Java ソースコードの記述

テンプレートの提供および Java からの適用は以下のような手準になります。

```sh
vi src/main/java/my/sandbox/App.java 
```

以下のように `App.java` を記述します。

```java
package my.sandbox;

import java.io.IOException;
import java.io.OutputStreamWriter;
import java.io.Reader;
import java.io.StringReader;
import java.util.HashMap;
import java.util.Map;

import freemarker.cache.TemplateLoader;
import freemarker.template.Configuration;
import freemarker.template.Template;
import freemarker.template.TemplateException;
import freemarker.template.TemplateExceptionHandler;

public class App {
	public static void main(String[] args) throws IOException, TemplateException {
		final Configuration config = new Configuration(Configuration.VERSION_2_3_25);
		config.setDefaultEncoding("UTF-8");
		config.setTemplateExceptionHandler(TemplateExceptionHandler.RETHROW_HANDLER);
		config.setLogTemplateExceptions(false);

		// set my custom template loader.
		config.setTemplateLoader(new TemplateLoader() {
			private long lastModified = System.currentTimeMillis();

			private static final String MY_TEMPLATE_STRING = "My name is ${user} desu.";

			public Object findTemplateSource(String name) throws IOException {
				System.out.println("TemplateName:" + name);
				return MY_TEMPLATE_STRING;
			}

			public long getLastModified(Object templateSource) {
				return lastModified;
			}

			public Reader getReader(Object templateSource, String encoding) throws IOException {
				return new StringReader(MY_TEMPLATE_STRING);
			}

			public void closeTemplateSource(Object templateSource) throws IOException {
				// do nothing.
			}
		});

		final Map<String, String> templateData = new HashMap<String, String>();
		templateData.put("user", "Taro Yamada");

		final Template templateBase = config.getTemplate("basic");
		templateBase.process(templateData, new OutputStreamWriter(System.out));
	}
}
```

### Java アプリの実行

```sh
mvn install exec:java
```

### 感想

[[Apache]] FreeMarker は基本的なテンプレート操作機能が備わっているように、今のところは感じています。

## 2017年 あけまして おめでとう ございます

今年も、健康に１年が過ごせますように。
