<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML lang="ja">
<HEAD>
<TITLE>2005/11/20 ���L: OpenOffice.org 2.0�� UNO�C���^�t�F�[�X��p�����t�@�C�����o��</TITLE>
<META name="DESCRIPTION" content="OpenOffice.org 2.0�������[�X���ꂽ�̂ŁA�Ђ����Ԃ�� OpenOffice.org ��API�ł���UNO�C���^�t�F�[�X�������܂����B">
<META name="KEYWORDS" content="�����҂��̓��Lv2,diary,igapyon">
<META name="GENERATOR" content="IBM WebSphere Studio Homepage Builder Version 9.0.1.0 for Windows">
<META name="DATE" content="2010-09-27T20:42:48+09:00">
<META http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
<META http-equiv="Content-Style-Type" content="text/css">
<LINK rel="INDEX" href="index.html">
<LINK rel="CONTENTS" href="index.html">
<LINK rel="stylesheet" href="../../css/table.css" type="text/css" id="_HPB_TABLE_CSS_ID_">
</HEAD>
<BODY bgcolor="#eeddcc">
<TABLE border="0"><TBODY><TR>
  <TD valign="top">
    <A href="../memo/memoigapyon.html">
      <IMG src="../../image/iga200306s.jpg" border="0" ALT="�����҂��摜(��) 2003/06">
    </A>
  </TD>
  <TD valign="top">
    <H2>2005/11/20 ���L: OpenOffice.org 2.0�� UNO�C���^�t�F�[�X��p�����t�@�C�����o��</H2>
    <P>[�����҂��̓��Lv2,diary,igapyon] OpenOffice.org 2.0�������[�X���ꂽ�̂ŁA�Ђ����Ԃ�� OpenOffice.org ��API�ł���UNO�C���^�t�F�[�X�������܂����B</P>
  </TD>
</TR></TBODY></TABLE>

<!-- adv -->
<CENTER>
<TABLE bgcolor="#ffff00" summary="adv">
  <TBODY>
    <TR>

      <TD align="center">�L��: <A href="http://journal.mycom.co.jp/column/ide/091/">�C�}�h�L��IDE����: Eclipse�x�[�X�̓����|����uBenten�v���g���Ă݂悤</A> <FONT color="#ff0000" size="-1">09/27</FONT><BR>
        <FONT size="-1">������������̎�ɂ�� Benten �Љ�L��!</FONT></TD>

    </TR>
  </TBODY>
</TABLE>
</CENTER>
<!-- adv -->




<P> </P>

<DIV align="right">
<TABLE cellpadding="4">
  <TBODY>
    <TR bgcolor="#99ccff">
      <TD><A href="../idxall.html">�C���f�B�b�N�X�y�[�W�֖߂�</A></TD>
    </TR>
  </TBODY>
</TABLE>
</DIV>



<TABLE summary="mini title">
  <TBODY>
    <TR>
      <TD bgcolor="#ff9900" valign="top"><FONT color="#ffffff" size="+1"><STRONG>OpenOffice.org 2.0�� UNO�C���^�t�F�[�X��p�����a�ʊm�F</STRONG></FONT></TD>
    </TR>
  </TBODY>
</TABLE>
<P><A HREF="http://ja.openoffice.org/" TITLE="���ݍł����ڂ���Ă���I�[�v���\�[�X�ɂ��I�t�B�X�X�C�[�g�����̂ЂƂBOpenOffice.org 2.0�ȍ~�ł̓h�L�������g�t�H�[�}�b�g�Ƃ��� OpenDocument���̗p���Ă���B">OpenOffice.org</A> 2.0�������[�X���ꂽ�̂ŁA�Ђ����Ԃ��UNO�C���^�t�F�[�X�������Ă݂܂����B<BR>
����� OpenOffice.org 2.0�ɂ����Ă� OpenOffice.org 1.1.x�n�Ɠ������͋C�œ��삷�邩�ǂ����𒲂ׂ�̂��ړI�ł��B�܂��͈ꎟ���\�[�X�ƂȂ�ׂ���񌹂��`�F�b�N���܂����B</P>
<UL>
  <LI>OpenOffice.org Develper's Guide<BR>
  <A HREF="http://api.openoffice.org/DevelopersGuide/DevelopersGuide.html">http://api.openoffice.org/DevelopersGuide/DevelopersGuide.html</A>
  <LI>Professional UNO<BR>
  <A HREF="http://api.openoffice.org/docs/DevelopersGuide/ProfUNO/ProfUNO.xhtml">http://api.openoffice.org/docs/DevelopersGuide/ProfUNO/ProfUNO.xhtml</A>
</UL>
<P>���� OpenOffice.1.1.x�n�� UNO�C���^�t�F�[�X�ɑ΂��Ă� ���I�ȕω��͉������Ă��Ȃ��悤�ɓǂݎ��܂����B�Ƃ������h�L�������g���X�V����Ă���̂��ǂ��������͌����_�ł͕s���ł��B</P>
<P>�܂��h�L�������g���牺�L��4��jar�t�@�C�����K�v�����ɓǂݎ�邱�Ƃ��ł��܂����B�����̃t�@�C���́AOpenOffice.org 2.0/program/classes
�f�B���N�g���Ɋi�[����Ă��܂��B�����ɂ��� Java����CLASSPATH�ɒʂ�悤�ɐݒ肵�܂��B</P>
<UL>
  <LI>juh.jar
  <LI>jurt.jar
  <LI>ridl.jar
  <LI>unoil.jar
</UL>
<P><STRONG><FONT color="#ff00ff">OpenOffice.org 2.0��UNO�T�|�[�g�t���ł̋N��</FONT></STRONG></P>
<P>���O�� OpenOffice.org 2.0�� UNO�T�|�[�g�t���ŋN�����܂��B(���� OpenOffice.org���N�����Ă���ꍇ�ɂ́A��U�I�����Ă��牺�L�R�}���h�ŋN�����܂��B�Ƃ��ɃN�C�b�N�����`�����삵�Ă���ꍇ�ɂ́A���O�Ɉ�U�I�������Ă������Ƃ��d�v�ł��B)</P>
<BLOCKQUOTE>
<TABLE border="1">
  <TBODY>
    <TR>
      <TD bgcolor="#ffff00">�R�}���h���C��: UNO�C���^�t�F�[�X�t����OpenOffice.org 2.0���N�����邽�߂̃R�}���h���C����</TD>
    </TR>
  </TBODY>
</TABLE>
<TABLE border="1">
  <TBODY>
    <TR>
      <TD>
      <pre>&quot;C:\Program Files\OpenOffice.org 2.0\program\soffice&quot; &quot;-accept=socket,port=8100;urp;&quot;</pre>
      </TD>
    </TR>
  </TBODY>
</TABLE>
</BLOCKQUOTE>
<P><STRONG><FONT color="#ff00ff">Java����OpenOffice.org�𑀍삷��T���v��</FONT></STRONG></P>
<P>�Ƃ肠����Calc��V�K�쐬������� PDF�t�@�C���𐶐�����T���v���ł��BOpenOffice.org 2.0 + Windows XP SP2
+ JDK 5.0�Ŏ����܂����B</P>
<BLOCKQUOTE>
<TABLE border="1">
  <TBODY>
    <TR>
      <TD bgcolor="#ffff00">OOoWritePDFSample.java</TD>
    </TR>
  </TBODY>
</TABLE>
<TABLE border="1">
  <TBODY>
    <TR>
      <TD>
      <pre>/*
 * OpenOffice.org: Excel�t�@�C���̐V�K�쐬�T���v��
 * Copyright (C) 2005 �ɉ�q��&lt;br&gt;
 * �쐬��: 2005/06/12&lt;br&gt;
 * �X�V��: 2005/11/20 OpenOffice.org 2.0�œ���m�F&lt;br&gt;
 */

import java.io.File;

import com.sun.star.beans.Property;
import com.sun.star.beans.PropertyValue;
import com.sun.star.beans.XPropertySet;
import com.sun.star.beans.XPropertySetInfo;
import com.sun.star.bridge.XBridge;
import com.sun.star.bridge.XBridgeFactory;
import com.sun.star.comp.helper.Bootstrap;
import com.sun.star.connection.ConnectionSetupException;
import com.sun.star.connection.NoConnectException;
import com.sun.star.connection.XConnection;
import com.sun.star.connection.XConnector;
import com.sun.star.frame.XComponentLoader;
import com.sun.star.frame.XController;
import com.sun.star.frame.XModel;
import com.sun.star.frame.XStorable;
import com.sun.star.lang.XComponent;
import com.sun.star.lang.XMultiComponentFactory;
import com.sun.star.sheet.XSpreadsheet;
import com.sun.star.sheet.XSpreadsheetDocument;
import com.sun.star.sheet.XSpreadsheetView;
import com.sun.star.sheet.XSpreadsheets;
import com.sun.star.text.XText;
import com.sun.star.uno.UnoRuntime;
import com.sun.star.uno.XComponentContext;

/**
 * @author Tosiki IGA
 */
public class OOoWritePDFSample {
    /**
     * UNO�ڑ��ŗ��p����ڑ�����
     */
    public static final String DEFAULT_CONNECTION_STRING = &quot;socket,host=localhost,port=8100,tcpNoDelay=1&quot;;

    /**
     * UNO�ڑ��ŗ��p����\�P�b�g�R�l�N�V����
     */
    private XConnection connection = null;

    public static void main(String[] args) {
        try {
            new OOoWritePDFSample().process();
        } catch (Exception ex) {
            ex.printStackTrace();
        }
    }

    public void process() throws Exception {
        System.out.println(&quot;Calc�u�b�N��V�K�쐬���ăt�@�C���ۑ����܂�.&quot;);

        File fileTarget = new File(&quot;./sample.pdf&quot;);
        if (fileTarget.exists()) {
            fileTarget.delete();
        }

        System.out.println(&quot;OpenOffice�ɐڑ����邽�߂̑O���������{���܂�.&quot;);
        XBridge bridge = createOOoBridge(DEFAULT_CONNECTION_STRING);
        if (bridge == null) {
            return;
        }
        Object desktop = createDesktopInstance(bridge);
        if (desktop == null) {
            return;
        }
        System.out.println(&quot;OpenOffice�ɐڑ����邽�߂̑O�������������܂���.&quot;);

        XComponentLoader componentLoader = (XComponentLoader) UnoRuntime
                .queryInterface(XComponentLoader.class, desktop);

        System.out.println(&quot;Calc�h�L�������g��V�K�쐬���܂�.&quot;);
        PropertyValue[] loadProps = new PropertyValue[1];
        loadProps[0] = new PropertyValue();
        loadProps[0].Name = &quot;Hidden&quot;;
        loadProps[0].Value = new Boolean(false);

        XComponent component = componentLoader.loadComponentFromURL(
                &quot;private:factory/scalc&quot;, &quot;_blank&quot;, 0, loadProps);
        XSpreadsheetDocument document = (XSpreadsheetDocument) UnoRuntime
                .queryInterface(XSpreadsheetDocument.class, component);

        System.out.println(&quot;Calc�V�[�g��V�K�쐬���܂�.&quot;);
        XSpreadsheets sheets = document.getSheets();
        sheets.insertNewByName(&quot;Sheet1&quot;, (short) 0);
        XSpreadsheet sheet = (XSpreadsheet) UnoRuntime.queryInterface(
                XSpreadsheet.class, sheets.getByName(&quot;Sheet1&quot;));

        System.out.println(&quot;Sheet1���A�N�e�B�u�ɐݒ肵�܂�.&quot;);
        XModel model = (XModel) UnoRuntime.queryInterface(XModel.class,
                component);
        XController controller = model.getCurrentController();
        XSpreadsheetView view = (XSpreadsheetView) UnoRuntime.queryInterface(
                XSpreadsheetView.class, controller);
        view.setActiveSheet(sheet);

        System.out.println(&quot;A1�ɒl���Z�b�g. (XText�o�R)&quot;);
        XText text = (XText) UnoRuntime.queryInterface(XText.class, sheet
                .getCellByPosition(0, 0));
        text.setString(&quot;test&quot;);

        System.out.println(&quot;A2�ɒl���Z�b�g. (setValue�o�R)&quot;);
        sheet.getCellByPosition(0, 1).setValue(123456);

        System.out.println(&quot;A3�ɒl���Z�b�g. (�Z���̃v���p�e�BFormulaLocal�o�R)&quot;);
        XPropertySet prop = (XPropertySet) UnoRuntime.queryInterface(
                XPropertySet.class, sheet.getCellByPosition(0, 2));
        prop.setPropertyValue(&quot;FormulaLocal&quot;, &quot;256,512&quot;);
        prop.setPropertyValue(&quot;CellBackColor&quot;, new Integer(0xC0C0C0));

        if (false) {
            System.out.println(&quot;PropertySetInfo���f�o�b�O�\�����܂�.&quot;);
            XPropertySetInfo propinfo = prop.getPropertySetInfo();
            Property[] props = propinfo.getProperties();
            for (int index = 0; index &lt; props.length; index++) {
                System.out.println(&quot;propertySet:&quot; + props[index].Name + &quot;=&quot;
                        + prop.getPropertyValue(props[index].Name).toString());
            }
        }

        Thread.sleep(2000);

        System.out.println(&quot;Calc�h�L�������g���w���PDF�t�@�C��(&quot;
                + fileTarget.getAbsolutePath() + &quot;)�ɕۑ��������܂�.&quot;);
        XStorable storable = (XStorable) UnoRuntime.queryInterface(
                XStorable.class, component);

        PropertyValue[] saveProps = new PropertyValue[1];
        saveProps[0] = new PropertyValue();
        saveProps[0].Name = &quot;FilterName&quot;;
        saveProps[0].Value = &quot;calc_pdf_Export&quot;;

        storable.storeToURL(fileTarget.toURL().toString(), saveProps);
        component.dispose();

        System.out.println(&quot;OpenOffice�ւ̐ڑ��̌㏈��(UNO�ڑ��̃N���[�Y����)�����{���܂�.&quot;);
        connection.close();

        System.out.println(&quot;Calc�u�b�N��V�K�쐬����PDF�t�@�C���ۑ��̈�A�̏������I�����܂�.&quot;);
    }

    /**
     * OpenOffic�ւ̃u���b�W�ڑ�(UNO�ڑ�)���I�[�v�����܂�
     * 
     * @param �ڑ�����
     * @return
     */
    public XBridge createOOoBridge(String connectionString) {
        System.out.println(&quot;OpenOffic�ւ̃u���b�W�ڑ�(UNO�ڑ�)���I�[�v�����܂�.&quot;);
        try {
            XComponentContext localContext = Bootstrap
                    .createInitialComponentContext(null);
            XMultiComponentFactory localServiceManager = localContext
                    .getServiceManager();
            XConnector connector = (XConnector) UnoRuntime.queryInterface(
                    XConnector.class, localServiceManager
                            .createInstanceWithContext(
                                    &quot;com.sun.star.connection.Connector&quot;,
                                    localContext));
            try {
                connection = connector.connect(connectionString);
            } catch (NoConnectException ex) {
                System.err.println(&quot;UNO�ڑ��Ɏ��s���܂���:&quot; + ex.toString());
                return null;
            } catch (ConnectionSetupException ex) {
                System.err.println(&quot;UNO�ڑ��̃Z�b�g�A�b�v�Ɏ��s���܂���:&quot; + ex.toString());
                return null;
            }
            XBridgeFactory bridgeFactory = (XBridgeFactory) UnoRuntime
                    .queryInterface(XBridgeFactory.class, localServiceManager
                            .createInstanceWithContext(
                                    &quot;com.sun.star.bridge.BridgeFactory&quot;,
                                    localContext));
            return bridgeFactory.createBridge(&quot;&quot;, &quot;urp&quot;, connection, null);
        } catch (Exception ex) {
            System.err.println(&quot;�u���b�W�쐬�����S�ʂ�ʂ��ė�O���������܂���.:&quot; + ex.toString());
            return null;
        }
    }

    /**
     * OpenOffice�̃f�X�N�g�b�v�C���X�^���X���쐬���܂�.
     * 
     * @param bridge
     * @return
     */
    public static Object createDesktopInstance(XBridge bridge) {
        System.out.println(&quot;OpenOffice�̃f�X�N�g�b�v�C���X�^���X���쐬���܂�.&quot;);
        try {
            XMultiComponentFactory serviceManager = (XMultiComponentFactory) UnoRuntime
                    .queryInterface(XMultiComponentFactory.class, bridge
                            .getInstance(&quot;StarOffice.ServiceManager&quot;));
            XPropertySet propertySet = (XPropertySet) UnoRuntime
                    .queryInterface(XPropertySet.class, serviceManager);
            XComponentContext remoteContext = (XComponentContext) UnoRuntime
                    .queryInterface(XComponentContext.class, propertySet
                            .getPropertyValue(&quot;DefaultContext&quot;));
            XMultiComponentFactory remoteServiceManager = remoteContext
                    .getServiceManager();
            return remoteServiceManager.createInstanceWithContext(
                    &quot;com.sun.star.frame.Desktop&quot;, remoteContext);
        } catch (Exception ex) {
            System.err.println(&quot;OpenOffice�̃f�X�N�g�b�v�C���X�^���X�쐬�ɂ����ė�O���������܂���.:&quot;
                    + ex.toString());
            return null;
        }
    }
}</pre>
      </TD>
    </TR>
  </TBODY>
</TABLE>
</BLOCKQUOTE>
<P>�Ƃ肠�����]���ʂ� ���삵�Ă���܂����B�悩�����A�悩����</P>
<HR>
<P><FONT color="#ff0000">2005.12.08�ǋL</FONT> OpenOffice.org�̓��{�ꉻ�Ɋւ��銈���ȂǂŗL���ȉm���܂��烁�[�����������܂����B</P>
<P><CITE>�����҂�� �l<BR>
�m(catch)�Ɛ\���܂��B<BR>
KOF2005�ł�������܂������A�o���Ă����łł��傤���B<BR>
���܂��܁A&quot;OpenDocument&quot;�ŃO�O�����Ƃ�����L�ɑ������܂����̂ŁA���[���������グ�܂����B</CITE></P>
<P><CITE>�u2005/11/20 ���L: OpenOffice.org 2.0�� UNO�C���^�t�F�[�X��p�����t�@�C�����o�́v�ɂāAOpenOffice.org
SDK�ɂ��Č��y���Ă��܂������AOpenOffice.org2.0��SDK�́AStarSuite8 SDK�Ƃ��ē��{�ꉻ����Ă��܂��B</CITE></P>
<UL>
  <LI><CITE>StarSuite 8 Software Software Development Kit (SDK)<BR>
  <A href="http://www.sun.com/software/star/starsuite/sdk/index.jsp">http://www.sun.com/software/star/starsuite/sdk/index.jsp</A></CITE>
</UL>
<P><CITE>�_�E�����[�h�y�[�W�͉p��ł����A���{��ł��_�E�����[�h�ł��܂��B�_�E�����[�h�ɂ̓��[�U�[�o�^���K�v�ł��B������Java�̂Ƃ��ɓo�^�����A�J�E���g�����̂܂܎g�����Ǝv���܂��B</CITE></P>
<P><CITE>���Q�l�ɂȂ�΍K���ł��B<BR>
����Ƃ��A�����V�N���肢���܂��B<BR>
----</CITE></P>
<P><FONT color="#ff00ff">��������https://www.igapyon.jp/igapyon/diary/memo/memoigapyon.htmlmemoigapyon.html" TITLE="�����҂��Ɋւ������">�����҂��</A><BR>
�c�b�R�~���肪�Ƃ��������܂��BOpenOffice.org 2.0��SDK�� �Ȃ�Ɠ��{�ꉻ����Ă����̂ł��ˁB�S���m��܂���ł����BSun���܂��܂ł��ˁB�����_�E�����[�h���Ă݂܂��B</P>
<P><FONT color="#ff00ff">�֘A������L</FONT></P>
<UL>
  <LI><A href="ig051118.html">2005/11/18 ���L: OASIS Open Document Format for Office Applications (OpenDocument)
  TC �̒���</A>
  <LI><A href="ig050612.html">2005/06/12 ���L: Java: OpenOffice.org SDK��p���� PDF�t�@�C����V�K�쐬����T���v��</A>
  <LI><A href="ig050610.html">2005/06/10 ���L: Java: OpenOffice.org SDK��p���� Excel�t�@�C����V�K�쐬����T���v��</A>
  <LI><A href="ig050614.html">2005/06/14 ���L: OpenOffice.org SDK��API�� �Ȃ����̂悤�Ȏp�����Ă���̂��ɂ��Ẵ���</A>
  <LI><A href="ig050225.html">2005/02/25 ���L: OpenOffice.org SDK�ւ̓��̂� , KNOPPIX+Web�T�[�o�ŃN���b�N�ϐ��^�p���\��</A>
</UL>
<TABLE summary="mini title">
  <TBODY>
    <TR>
      <TD bgcolor="#ff9900" valign="top"><FONT color="#ffffff" size="+1"><STRONG>OpenOffice.org 2.0�̃t�B���^�ꗗ</STRONG></FONT></TD>
    </TR>
  </TBODY>
</TABLE>
<P>OpenOffice.org �ŗ��p�\�ȃt�B���^�ꗗ��URL���������Ă����܂��B</P>
<UL>
  <LI>Filter Description<BR>
  <A HREF="http://framework.openoffice.org/files/documents/25/897/filter_description.html">http://framework.openoffice.org/files/documents/25/897/filter_description.html</A>
</UL>
<P>�����_�Ŏ������ړI�Ɋ֌W�������ȃt�B���^���������Ă����܂��B</P>
<UL>
  <LI>MS Excel 97
  <LI>calc_pdf_Export
  <LI>StarOffice XML (Calc)
</UL>
<TABLE summary="mini title">
  <TBODY>
    <TR>
      <TD bgcolor="#ff9900" valign="top"><FONT color="#ffffff" size="+1"><STRONG>OpenOffice.org 2.0���g���� Excel�u�b�N�� Calc�`���ɕϊ�����T���v��</STRONG></FONT></TD>
    </TR>
  </TBODY>
</TABLE>
<P>�ȒP�� Excel�u�b�N��Calc�`�� (<A HREF="https://www.igapyon.jp/igapyon/diary/keyword/opendocument.html" TITLE="OpenOffice.org 2.0�ȍ~�ō̗p����Ă���h�L�������g�t�H�[�}�b�g�BXML�̐��E�ł͗L����OASIS�Ƃ����W�����c�̂ɂ���ĕW������Ƃ������Ȃ��Ă��܂��B">OpenDocument</A>) �ɕϊ�����T���v���������Ă݂܂����B<BR>
�������Ă��ꂪ�A������ blancoReport�̌��l�^�ɂȂ�܂��B</P>
<BLOCKQUOTE>
<TABLE border="1">
  <TBODY>
    <TR>
      <TD bgcolor="#ffff00">OOoExcel2CalcSample.java</TD>
    </TR>
  </TBODY>
</TABLE>
<TABLE border="1">
  <TBODY>
    <TR>
      <TD>
      <pre>/*
 * OpenOffice.org: Excel�`����Calc�`���ɕϊ�����T���v��
 * Copyright (C) 2005 �ɉ�q�� �쐬��: 2005/11/20
 */

import java.io.File;

import com.sun.star.beans.PropertyValue;
import com.sun.star.beans.XPropertySet;
import com.sun.star.bridge.XBridge;
import com.sun.star.bridge.XBridgeFactory;
import com.sun.star.comp.helper.Bootstrap;
import com.sun.star.connection.ConnectionSetupException;
import com.sun.star.connection.NoConnectException;
import com.sun.star.connection.XConnection;
import com.sun.star.connection.XConnector;
import com.sun.star.frame.XComponentLoader;
import com.sun.star.frame.XStorable;
import com.sun.star.lang.XComponent;
import com.sun.star.lang.XMultiComponentFactory;
import com.sun.star.uno.UnoRuntime;
import com.sun.star.uno.XComponentContext;

/**
 * @author IGA Tosiki
 */
public class OOoExcel2CalcSample {
    /**
     * UNO�ڑ��ŗ��p����ڑ�����
     */
    public static final String DEFAULT_CONNECTION_STRING = &quot;socket,host=localhost,port=8100,tcpNoDelay=1&quot;;

    /**
     * UNO�ڑ��ŗ��p����\�P�b�g�R�l�N�V����
     */
    private XConnection connection = null;

    public static void main(String[] args) {
        try {
            new OOoExcel2CalcSample().process();
        } catch (Exception ex) {
            ex.printStackTrace();
        }
    }

    public void process() throws Exception {
        final File fileSource = new File(&quot;./sample.xls&quot;);
        if (fileSource.exists() == false) {
            throw new IllegalArgumentException(&quot;���̓t�@�C��[&quot; + fileSource.getName()
                    + &quot;]��������܂���B�������f���܂��B&quot;);
        }

        final File fileTarget = new File(&quot;./sample.ods&quot;);
        if (fileTarget.exists()) {
            if (fileTarget.delete() == false) {
                throw new IllegalArgumentException(&quot;�o�̓t�@�C��[&quot;
                        + fileTarget.getName()
                        + &quot;]�����݂����̂ŏ����ɐ旧���폜���悤�Ƃ��܂������폜�Ɏ��s���܂����B�������f���܂��B&quot;);
            }
        }

        System.out.println(&quot;OpenOffice�ɐڑ����邽�߂̑O���������{���܂�.&quot;);
        XBridge bridge = createOOoBridge(DEFAULT_CONNECTION_STRING);
        if (bridge == null) {
            return;
        }
        Object desktop = createDesktopInstance(bridge);
        if (desktop == null) {
            return;
        }
        System.out.println(&quot;OpenOffice�ɐڑ����邽�߂̑O�������������܂���.&quot;);

        XComponentLoader componentLoader = (XComponentLoader) UnoRuntime
                .queryInterface(XComponentLoader.class, desktop);

        System.out.println(&quot;���̓t�@�C���ł���Excel�h�L�������g���J���܂�.&quot;);
        PropertyValue[] loadProps = new PropertyValue[1];
        loadProps[0] = new PropertyValue();
        loadProps[0].Name = &quot;Hidden&quot;;
        loadProps[0].Value = new Boolean(false);

        // [file:///]�ƂȂ��Ă��Ȃ��ƃI�[�v���ł��Ȃ��̂ŁAURL�𒲐����܂��B
        final String urlSource = fileSource.getCanonicalFile().toURL()
                .toString().replace(&quot;file:/&quot;, &quot;file:///&quot;);
        final String urlTarget = fileTarget.getCanonicalFile().toURL()
                .toString().replace(&quot;file:/&quot;, &quot;file:///&quot;);

        XComponent component = componentLoader.loadComponentFromURL(urlSource,
                &quot;_blank&quot;, 0, loadProps);
        // XSpreadsheetDocument document = (XSpreadsheetDocument) UnoRuntime
        // .queryInterface(XSpreadsheetDocument.class, component);

        System.out.println(&quot;Excel�t�@�C��[&quot; + fileSource.getAbsolutePath()
                + &quot;]��Calc�t�@�C��[&quot; + fileTarget.getAbsolutePath() + &quot;]�ɕϊ��������܂�.&quot;);
        XStorable storable = (XStorable) UnoRuntime.queryInterface(
                XStorable.class, component);

        PropertyValue[] saveProps = new PropertyValue[1];
        saveProps[0] = new PropertyValue();
        saveProps[0].Name = &quot;FilterName&quot;;
        saveProps[0].Value = &quot;StarOffice XML (Calc)&quot;;

        storable.storeToURL(urlTarget, saveProps);
        component.dispose();

        System.out.println(&quot;OpenOffice�ւ̐ڑ��̌㏈��(UNO�ڑ��̃N���[�Y����)�����{���܂�.&quot;);
        connection.close();

        System.out.println(&quot;Excel�u�b�N��V�K�쐬���ăt�@�C���ۑ��̈�A�̏������I�����܂�.&quot;);
    }

    /**
     * OpenOffic�ւ̃u���b�W�ڑ�(UNO�ڑ�)���I�[�v�����܂�
     * 
     * @param �ڑ�����
     * @return
     */
    public XBridge createOOoBridge(String connectionString) {
        System.out.println(&quot;OpenOffic�ւ̃u���b�W�ڑ�(UNO�ڑ�)���I�[�v�����܂�.&quot;);
        try {
            XComponentContext localContext = Bootstrap
                    .createInitialComponentContext(null);
            XMultiComponentFactory localServiceManager = localContext
                    .getServiceManager();
            XConnector connector = (XConnector) UnoRuntime.queryInterface(
                    XConnector.class, localServiceManager
                            .createInstanceWithContext(
                                    &quot;com.sun.star.connection.Connector&quot;,
                                    localContext));
            try {
                connection = connector.connect(connectionString);
            } catch (NoConnectException ex) {
                System.err.println(&quot;UNO�ڑ��Ɏ��s���܂���:&quot; + ex.toString());
                return null;
            } catch (ConnectionSetupException ex) {
                System.err.println(&quot;UNO�ڑ��̃Z�b�g�A�b�v�Ɏ��s���܂���:&quot; + ex.toString());
                return null;
            }
            XBridgeFactory bridgeFactory = (XBridgeFactory) UnoRuntime
                    .queryInterface(XBridgeFactory.class, localServiceManager
                            .createInstanceWithContext(
                                    &quot;com.sun.star.bridge.BridgeFactory&quot;,
                                    localContext));
            return bridgeFactory.createBridge(&quot;&quot;, &quot;urp&quot;, connection, null);
        } catch (Exception ex) {
            System.err.println(&quot;�u���b�W�쐬�����S�ʂ�ʂ��ė�O���������܂���.:&quot; + ex.toString());
            return null;
        }
    }

    /**
     * OpenOffice�̃f�X�N�g�b�v�C���X�^���X���쐬���܂�.
     * 
     * @param bridge
     * @return
     */
    public static Object createDesktopInstance(XBridge bridge) {
        System.out.println(&quot;OpenOffice�̃f�X�N�g�b�v�C���X�^���X���쐬���܂�.&quot;);
        try {
            XMultiComponentFactory serviceManager = (XMultiComponentFactory) UnoRuntime
                    .queryInterface(XMultiComponentFactory.class, bridge
                            .getInstance(&quot;StarOffice.ServiceManager&quot;));
            XPropertySet propertySet = (XPropertySet) UnoRuntime
                    .queryInterface(XPropertySet.class, serviceManager);
            XComponentContext remoteContext = (XComponentContext) UnoRuntime
                    .queryInterface(XComponentContext.class, propertySet
                            .getPropertyValue(&quot;DefaultContext&quot;));
            XMultiComponentFactory remoteServiceManager = remoteContext
                    .getServiceManager();
            return remoteServiceManager.createInstanceWithContext(
                    &quot;com.sun.star.frame.Desktop&quot;, remoteContext);
        } catch (Exception ex) {
            System.err.println(&quot;OpenOffice�̃f�X�N�g�b�v�C���X�^���X�쐬�ɂ����ė�O���������܂���.:&quot;
                    + ex.toString());
            return null;
        }
    }
}</pre>
      </TD>
    </TR>
  </TBODY>
</TABLE>
</BLOCKQUOTE>
<HR>
<address><A HREF="../memo/memoigapyon.html">�����҂��ɂ���</A><BR>
Last modified: $Date: 2010/09/27 20:42:48 $</address>
</BODY>
</HTML>
