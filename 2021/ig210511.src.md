## [Oiyokan] Getting Started Oiyokan Initializr (v0.5)

このエントリでは [[Oiyokan]] Initializr の使い方を記述します。Oiyokan Initializr Release 0.5 (2021-05-11)をもとに記載します。
なお、本記載は、読者がある程度 Spring Boot および Web、REST/JSON、JDBC、そしてセキュリティ観点 に慣れていることを前提としています。

Oiyokan を利用すると手元の RDB を OData 4.0 Server 規約に則った REST/JSON サーバとして公開することができます。そのようなサーバを素早く構築するためのツールが [Oiyokan Initializr](https://github.com/igapyon/oiyokan-initializr) です。

### oiyokan-initializr を入手

![01](http://www.igapyon.jp/igapyon/diary/images/2021/20210511-01.png)

1-1. [github.com](https://github.com/igapyon/oiyokan-initializr/releases) `oiyokan-initializr` の Release から `Source code (zip)` をダウンロードします

![02](http://www.igapyon.jp/igapyon/diary/images/2021/20210511-02.png)

1-2. お好みのディレクトリに `Source code (zip)` を展開します

![03](http://www.igapyon.jp/igapyon/diary/images/2021/20210511-03.png)

### oiyokan-initializr を実行

2-1. Maven を利用して `oiyokan-initializr` をビルドおよび実行します

展開されたディレクトリに移動して、以下の mvn コマンドを実行します。

```sh
mvn install spring-boot:run
```

しばらくすると `oiyokan-initializr` が Webサーバとして起動します。

## `oiyokan-initializr` を使用して REST API Server (OData v4) を生成

3-1. 起動後の `oiyokan-initializr` に Web ブラウザで接続します。

```sh
http://localhost:8082/
```

![04](http://www.igapyon.jp/igapyon/diary/images/2021/20210511-04.png)

ワンポイント Tips: `application.properties` ファイルの server.port の値を変更することによりポート番号を変更できます。

3-2. `START CREATING REST API SERVER FOR RDB` をクリックします。

3-3. basic authentication ダイアログが表示される場合には、User: admin, Password: passwd123 を利用してログインしてください。

![05](http://www.igapyon.jp/igapyon/diary/images/2021/20210511-05.png)

3-4. `ADD DATABASE` をクリックします。

![06](http://www.igapyon.jp/igapyon/diary/images/2021/20210511-06.png)

3-5. データベース設定情報を入力します。

![07](http://www.igapyon.jp/igapyon/diary/images/2021/20210511-07.png)

3-6. `CONNECTION TEST` をクリックします。

![08](http://www.igapyon.jp/igapyon/diary/images/2021/20210511-08.png)

- データベースに接続成功した場合には `Connection test success` などと表示されます。
- もしデータベース接続テストが失敗する場合には、JDBC設定情報やネットワーク経路、データベースが起動しているかどうかを確認してください。

3-7. `APPLY DATABASE SETTINGS` をクリックします。

### Entity を選択

4-1. `ADD ENTITY` をクリックします。

![09](http://www.igapyon.jp/igapyon/diary/images/2021/20210511-09.png)

4-2. REST API Server に公開したい Entity (テーブル) をチェックボックスをクリックして選択します。

![10](http://www.igapyon.jp/igapyon/diary/images/2021/20210511-10.png)

4-3. Entity の選択を終えたら `APPLY ENTITY SELLECTION` をクリックします。

![11](http://www.igapyon.jp/igapyon/diary/images/2021/20210511-11.png)

### REST API Server の生成

5-1. `GENERATE REST API SERVER` をクリックして、`oiyokan-demo.zip` という名前の ZIP ファイルをダウンロードします。

![12](http://www.igapyon.jp/igapyon/diary/images/2021/20210511-12.png)

  Note: なお、この手順で生成される `oiyokan-demo.zip` にはデータベース接続情報の記載を含む `oiyokan-settings.json` ファイルが含まれます。必要ない場合は手順の後に必ず削除します。

5-2. `Oiyokan Initializr` を終了します。

CTRL+C などの操作により、`Oiyokan Initializr` を停止できます。

### 生成された REST API Server (OData v4) の実行

6-1. 作業に都合の良いディレクトリで `oiyokan-demo.zip` を zip展開します。

![13](http://www.igapyon.jp/igapyon/diary/images/2021/20210511-13.png)

  ここで展開したファイルの `oiyokan-settings.json` にはデータベースの接続情報が含まれますので、必要ない場合は手順の後で必ず削除してください。

6-2. zip 展開後のフォルダで以下のように Maven コマンドをもちいて `oiyokan-demo` を起動します。

```sh
mvn install spring-boot:run
```

6-3. 起動後の `oiyokan-demo` に Web ブラウザで接続します。

```sh
http://localhost:8080/
```

この手順により起動するサーバが REST API Server (OData v4) の機能を提供してデータベースへのアクセスを提供します。

### REST を用いたアクセス

REST API Server には REST (OData v4) 手順を用いてデータの作成/検索/更新/削除をおこなうことができます。

![14](http://www.igapyon.jp/igapyon/diary/images/2021/20210511-14.png)

7-1. `OData v4 ROOT` をクリックすると、公開されている Entity の概要を確認できます。

![15](http://www.igapyon.jp/igapyon/diary/images/2021/20210511-15.png)

7-2. `OData $metadata` をクリックすると、公開されている Entity の詳細を確認できます。

![16](http://www.igapyon.jp/igapyon/diary/images/2021/20210511-16.png)

7-3. actor?$top=3 などといった OData v4 パラメータクエリ記法をもちいてデータを検索して表示できます。

![17](http://www.igapyon.jp/igapyon/diary/images/2021/20210511-17.png)

7-4. POST, PATCH, DELETE コマンドをもちいて、データベースのレコードを操作することができます。

### 後片付け

8-1. 試行が終わったら、`oiyokan-demo` を終了します。

8-2. 試行が終わり次第、`oiyokan-demo.zip` および展開後のファイル `oiyokan-settings.json` を削除します。

  Note: この一連の手順で登場する `oiyokan-settings.json` ファイルにはデータベース接続情報の記載が含まれます。`oiyokan-demo.zip` も含めて必要ない場合は手順の後に必ず削除します。

以上が Oiyokan Initializr の簡易な説明です。

### 関連する日記

- <@linkdiary date="2021-05-11" />
- <@linkdiary date="2021-05-09" />
- <@linkdiary date="2021-05-05" />
- <@linkdiary date="2021-04-25" />

## 場所により真夏日

今年は夏日・真夏日が早いように思えます。

<@lastmodified date="2021-05-11"/>
